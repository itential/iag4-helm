suite: test ssh configmap
templates:
  - configmap_ssh.yaml
values:
  - ../tests/test-values.yaml
tests:
  - it: should create ConfigMap with correct metadata
    asserts:
      - isKind:
          of: ConfigMap
      - isAPIVersion:
          of: v1
      - equal:
          path: metadata.name
          value: ssh-config-map

  - it: should include helm labels
    asserts:
      - exists:
          path: metadata.labels
      - isSubset:
          path: metadata.labels
          content:
            app.kubernetes.io/managed-by: Helm

  - it: should render with custom values
    set:
      nameOverride: "custom-app"
    asserts:
      - isSubset:
          path: metadata.labels
          content:
            app.kubernetes.io/name: custom-app

  - it: should work with different release names
    release:
      name: "test-release"
    asserts:
      - isSubset:
          path: metadata.labels
          content:
            app.kubernetes.io/instance: test-release

  - it: should have the expected standard annotations
    set:
      configmap:
        annotations: {}
    asserts:
      - exists:
          path: metadata.annotations["itential.com/copyright"]
      - exists:
          path: metadata.annotations["itential.com/license"]
      - exists:
          path: metadata.annotations["helm.sh/template-file"]

  - it: should allow for custom annotations
    set:
      configMap:
        annotations:
          foo: "bar"
    asserts:
      - equal:
          path: metadata.annotations["foo"]
          value: bar